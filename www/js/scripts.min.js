document.addEventListener("deviceready",function(){navigator.notification&&(window.alert=function(a){navigator.notification.alert(a,null,"Kimote","OK")})},!1);var app=angular.module("app",["ionic","ngCookies","ngSanitize","angular-duration-format","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.buffering","com.2fdevs.videogular.plugins.poster","com.2fdevs.videogular.plugins.dash"]);app.run(["$ionicPlatform",function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]),app.config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("tabs",{url:"/tab","abstract":!0,templateUrl:"views/tabs.html"}).state("about",{url:"/about",views:{about:{templateUrl:"views/about.html"}}}).state("tabs.remote",{url:"/remote",views:{"remote-tab":{templateUrl:"views/remote.html",controller:"RemoteCtrl"}}}).state("tabs.movies",{url:"/movies",views:{"movies-tab":{templateUrl:"views/movies/movies.html",controller:"MoviesCtrl"}}}).state("tabs.movie-details",{url:"/movies/:movieLabel",views:{"movies-tab":{templateUrl:"views/movies/movie-detail.html",controller:"MoviesCtrl"}}}).state("tabs.tvshows",{url:"/tvshows",views:{"tvshows-tab":{templateUrl:"views/tvshows/tvshows.html",controller:"TVShowsCtrl"}}}).state("tabs.tvshow-detail",{url:"/tvshows/:seriesLabel/:seriesId",views:{"tvshows-tab":{templateUrl:"views/tvshows/tvshow-detail.html",controller:"TVShowsCtrl"}}}).state("tabs.season-detail",{url:"/season-detail/:seriesId/:seasonId",views:{"tvshows-tab":{templateUrl:"views/tvshows/season-detail.html",controller:"TVShowsCtrl"}}}).state("tabs.episode-detail",{url:"/episode-detail/:episodeLabel/:episodeId",views:{"tvshows-tab":{templateUrl:"views/tvshows/episode-detail.html",controller:"TVShowsCtrl"}}}).state("tabs.music",{url:"/music",views:{"music-tab":{templateUrl:"views/music/music.html",controller:"MusicCtrl"}}}).state("tabs.music-albums",{url:"/albums/:artistLabel/:artistId",views:{"music-tab":{templateUrl:"views/music/music-albums.html",controller:"MusicCtrl"}}}).state("tabs.music-songs",{url:"/songs/:albumLabel/:albumId",views:{"music-tab":{templateUrl:"views/music/music-songs.html",controller:"MusicCtrl"}}}).state("tabs.track-detail",{url:"/track-detail/:songId/:songLabel",views:{"music-tab":{templateUrl:"views/music/track-detail.html",controller:"MusicCtrl"}}}).state("tabs.files",{url:"/files",views:{"files-tab":{templateUrl:"views/files.html",controller:"FilesCtrl"}}}).state("tabs.pics",{url:"/pics",views:{"pics-tab":{templateUrl:"views/pics.html",controller:"PicsCtrl"}}}),b.otherwise("/tab/remote")}]),app.controller("FilesCtrl",["$scope","$http","$ionicLoading","Loader",function(a,b,c,d){var e="";a.title="Sources",a.getStart=function(){method="Files.GetSources",params='{"media":"files"}',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+',"id":2}',complete_url=window.base_url+param_url,c.show(),b.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(b,d,e,f){a.files=b.result.sources,a.title="Files",c.hide(),a.$broadcast("scroll.refreshComplete")}).error(function(b,d,e,f){c.hide(),a.$broadcast("scroll.refreshComplete"),alert("Error fetching sources")})},a.getDir=function(d){method="Files.GetDirectory",params='{"directory":"'+d+'","media":"files"}}',param_url='/jsonrpc?request={"jsonrpc":"2.0","id":1,"method":"'+method+'", "params":'+params+',"id":1}',complete_url=window.base_url+param_url,c.show(),b.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(b,f,g,h){c.hide(),"result"in b?(a.files=b.result.files,e=d,a.title=e):a.getStart()}).error(function(a,b,d,e){c.hide()})},a.getFile=function(b){var c=b.file;"file"==b.filetype?1==f(c)?g(c):alert("The file cannot be played"):a.getDir(c)},a.getParent=function(){for(var b=new RegExp("/","g"),c=e.split(b),d="",f=1;f<c.length-2;f++)d=d+"/"+c[f];a.getDir(d+"/")};var f=function(a){var b=["3gp","aif","aiff","aac","amr","flac","m3u","m4a","mid","midi","mp2","mp3","ogg","oga","wav","wma","avi","mp4","mkv","mpeg","bmp","jpg","jpeg","gif","png","tif","tiff","ico"],c=/\.[0-9a-z]{1,5}$/i,d=a.match(c)[0];return d=d.substring(1),b.indexOf(d)>0?1:0},g=function(a){method="Player.Open",params='{"item":{"file":"'+a+'"}}',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,b,c,d){}).error(function(a,b,c,d){alert("Cannot read file")})}}]),app.controller("MoviesCtrl",["$scope","$http","$stateParams","$location","$ionicLoading","$sce","Loader",function(a,b,c,d,e,f,g){a.movie_label=c.movieLabel,a.showMovies=function(){g.getMovies(function(b){a.movies=b.result.movies,a.$broadcast("scroll.refreshComplete")})},a.playMovieOnKodi=function(a){method="Player.Open",params='{"item":{"file":"'+a+'"}}',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,b,c,d){}).error(function(a,b,c,d){alert("Cannot play this movie")})},a.getStreamInfo=function(b,c){var d=encodeURIComponent(b),e=window.base_url+"/vfs/"+d;c=c.replace("image://","");var g=decodeURIComponent(c);return a.config={sources:[{src:f.trustAsResourceUrl(e),type:"video/mp4"}],theme:"lib/videogular-themes-default/videogular.min.css",plugins:{poster:g}},a.config},a.showSearch=!1,a.searchBox=function(){a.showSearch=!a.showSearch},a.Math=window.Math,a.toHours=function(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60);10>c&&(c="0"+c);var d=b+"h"+c;return d},a.getThumbnail=function(a){a=a.replace("image://","");var b=decodeURIComponent(a);return b}}]),app.controller("MusicCtrl",["$scope","$http","$stateParams","$location","$ionicLoading","$sce","Loader",function(a,b,c,d,e,f,g){a.artist_label=c.artistLabel,a.artist_id=c.artistId,a.album_label=c.albumLabel,a.album_id=c.albumId,a.song_label=c.songLabel,a.song_id=c.songId,a.showArtists=function(){g.getArtists(function(b){a.artists=b.result.artists,a.$broadcast("scroll.refreshComplete")})},a.showAlbums=function(b){g.getAlbums(b,function(b){a.albums=b.result.albums,a.$broadcast("scroll.refreshComplete")})},a.showSongs=function(b){g.getSongs(b,function(b){a.songs=b.result.songs,a.$broadcast("scroll.refreshComplete")})},a.showSongDetails=function(b){g.getSongDetails(b,function(b){a.songdetails=b.result.songdetails,a.getStreamInfoMusic(a.songdetails.file)})},a.playSong=function(a){method="Player.Open",params='{"item":{"file":"'+a+'"}}',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,b,c,d){}).error(function(a,b,c,d){alert("Cannot play this track")})},a.getStreamInfoMusic=function(b){var c=encodeURIComponent(b),d=window.base_url+"/vfs/"+c;return a.config={sources:[{src:f.trustAsResourceUrl(d),type:"audio/mpeg"}],theme:"lib/videogular-themes-default/videogular.min.css"},a.config},a.showSearch=!1,a.searchBox=function(){a.showSearch=!a.showSearch},a.Math=window.Math,a.toMinutes=function(a){var b=Math.floor(a/60),c=a-60*b;10>c&&(c="0"+c);var d=b+":"+c;return d},a.getThumbnailArtist=function(a){a=a.replace("image://","").replace("jpg/","jpg");var b=decodeURIComponent(a);return b},a.getThumbnailAlbum=function(a){a=a.replace("image://","");var b=encodeURIComponent(a),c=window.base_url+"/image/image://"+b;return c}}]),app.controller("PicsCtrl",["$scope","$http","Requester",function(a,b,c){a.request=function(a){switch(a){case"zoom+":c.requestInput(a);break;case"zoom-":c.requestInput(a);break;case"pictures":c.requestGUI(a);break;default:c.requestInput(a)}}}]),app.controller("RemoteCtrl",["$scope","$http","$stateParams","$location","$ionicPopup","$timeout","Sounder","Manager","Runtime","Requester","Logger",function(a,b,c,d,e,f,g,h,i,j,k){a.model={},a.getSync=function(){var b=i.GetRuntime();b.shuffled===!0?a.shuffledImg=!0:a.shuffledImg=!1,0===b.speed?a.played=!1:a.played=!0,"off"===b.repeat?a.repeatImg=0:"one"===b.repeat?a.repeatImg=1:a.repeatImg=2,k.getConn()===!0&&j.GetApplicationProperties(function(b){a.muted=b.result.muted})},setInterval(a.getSync,200),a.getRuntime=function(){var b=i.GetRuntime();a.model.runtime=b.moment2,a.model.temps=b.temps,a.model.totaltime=b.totaltime,a.model.playeractive=b.playeractive,a.model.getDetails=b.getDetails},setInterval(a.getRuntime,500),a.setRuntime=function(){i.SetRuntime(a.model.runtime)},a.toMinutes=function(a){var b=a.seconds,c=a.minutes,d=a.hours;10>b&&(b="0"+b),10>c&&(c="0"+c),10>d&&(d="0"+d);var e=d+":"+c+":"+b;return e},a.playerisActive=function(a){return"undefined"!==a?!1:!0},a.whichPlayer=function(a){return 0===a?!0:1===a?!1:void 0},a.requestMute=function(){method="Application.SetMute",params='{"mute":"toggle"}',j.sendRequest(b,method,params)},a.showAlert=function(){e.alert({title:"Volume",template:'<input type="range" name="volume" ng-model="model.sound" min="0" max="100" ng-change="setVol()">',scope:a})},a.requestPlayer=function(a){switch(a){case"shuffle":method="Player.SetShuffle",params='"shuffle":'+!i.GetRuntime().shuffled;break;case"repeat":method="Player.SetRepeat","off"===i.GetRuntime().repeat?params='"repeat": "one"':"one"===i.GetRuntime().repeat?params='"repeat" : "all"':params='"repeat" : "off"';break;case"subtitles":method="Player.SetSubtitle",i.GetRuntime().subtitles===!0?params='"subtitle": "off"':i.GetRuntime().subtitles===!1&&(params='"subtitle" : "on"');break;default:method="",params=""}j.sendRequestWithParamsForPlayer(b,method,params)},a.requestOSD=function(){method="Input.ShowOSD",params="{}",j.sendRequest(b,method,params)},a.getThumbnail=function(b,c){return 1===c?(b=b.replace("image://",""),a.thumbnailUriDecoded=decodeURIComponent(b),a.thumbnailUriDecoded):0===c?(b=b.replace("image://",""),thumbnailURIencoded=encodeURIComponent(b),a.thumbnailUriComplete=window.base_url+"/image/image://"+thumbnailURIencoded,a.thumbnailUriComplete):void 0},a.request=function(b){switch(b){case"fullscreen":j.requestGUI(b);break;case"shutdown":j.requestApplication(b,0);break;case"mute":j.requestApplication(b,0);break;case"unmute":j.requestApplication(b,0);break;case"volumeUp":j.requestApplication(b,a.volume);break;case"volumeDown":j.requestApplication(b,a.volume);break;default:j.requestInput(b)}}}]),app.controller("SideMenuCtrl",["$scope","$http","$cookieStore","$ionicModal","$ionicSideMenuDelegate","$ionicPopup","Logger","Sounder","$ionicLoading","Requester",function(a,b,c,d,e,f,g,h,i,j){a.getDeviceName=function(c,d,e,f){test_url="http://"+c+":"+d+"@"+e+":"+f,method="Application.GetProperties",params='{"properties":["name"]}',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+', "id" : 1}',complete_url=test_url+param_url,b.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(b,c,d,g){a.icon=!0,a.device=b.result.name+" ("+e+":"+f+")"})},a.soundbar={},a.sound=h.getVolume(),a.setVol=function(){h.SetVol(a.soundbar.sound),a.soundbar.sound=h.getVolume()},a.showAlert=function(){var b=f.alert({title:"Volume",template:'<div class="range"><i class="icon ion-volume-low"></i><input type="range" name="volume" ng-model="soundbar.sound" min="0" max="100" ng-change="setVol()"><i class="icon ion-volume-high"></i></div>',scope:a});b.then(function(a){console.log("In alertPopup.then")})},d.fromTemplateUrl("views/about.html",{scope:a}).then(function(b){a.modalAbout=b}),a.openAbout=function(){a.modalAbout.show()},a.closeAbout=function(){a.modalAbout.hide()},d.fromTemplateUrl("views/login.html",{scope:a}).then(function(b){a.modal=b}),a.openLogin=function(){a.modal.show()},a.closeLogin=function(){a.modal.hide()},a.showMenu=function(){e.toggleLeft()},d.fromTemplateUrl("views/autologin.html",{scope:a}).then(function(b){a.modalAuto=b}),a.openAuto=function(){a.modalAuto.show()},a.closeAuto=function(){a.modalAuto.hide()},a.loginData={},a.IPMODEL=/^([0-9]{1,3}\.){3}[0-9]{1,3}$/,a.bouton=g.getBouton(),a.connected=g.getConn(),a.errCon=g.getErr(),a.loginData.StoreID=!0,a.doLogin=function(){g.login(a.loginData.username,a.loginData.password,a.loginData.ip,a.loginData.port),a.bouton=g.getBouton(),a.connected=g.getConn(),a.errCon=g.getErr(),a.loginData.StoreID&&(c.put("ip",a.loginData.ip),c.put("port",a.loginData.port.toString()),c.put("username",a.loginData.username),c.put("password",a.loginData.password),console.log(a.loginData.StoreID)),a.closeLogin()},a.logout=function(){g.logout(),a.bouton=g.getBouton(),a.connected=g.getConn(),a.errCon=g.getErr()},a.removeID=function(){a.loginData.ip=c.remove("ip"),a.loginData.port=c.remove("port"),a.loginData.username=c.remove("username"),a.loginData.password=c.remove("password")},a.loginData.ip=c.get("ip"),a.loginData.port=parseInt(c.get("port")),a.loginData.username=c.get("username"),a.loginData.password=c.get("password"),a.hideAuto=!1,a.scanAuto=function(){a.hideAuto=!1,ZeroConf.list("_http._tcp.local.",5e3,function(b){a.users=b.service},function(a){alert("No Media Center discovered")})},a.loadingScanAuto=function(){i.show({duration:5e3})},a.hideChoices=function(b){a.hideAuto=!a.hideAuto,a.loginData.ip=b.addresses[0],a.loginData.port=b.port,a.loginData.username2=b.name},a.showChoices=function(b){a.hideAuto=!a.hideAuto}}]),app.controller("TVShowsCtrl",["$scope","$http","$location","$stateParams","$ionicLoading","$sce","Loader",function(a,b,c,d,e,f,g){a.series_id=d.seriesId,a.series_label=d.seriesLabel,a.season_id=d.seasonId,a.episode_id=d.episodeId,a.episode_label=d.episodeLabel,a.showSeries=function(){g.getSeries(function(b){a.tvshows=b.result.tvshows,a.$broadcast("scroll.refreshComplete")})},a.showSeasons=function(b){g.getSeasons(b,function(b){a.seasons=b.result.seasons,a.$broadcast("scroll.refreshComplete")})},a.showEpisodes=function(b,c){g.getEpisodes(b,c,function(b){a.episodes=b.result.episodes,a.$broadcast("scroll.refreshComplete")})},a.showEpisodeDetails=function(b){g.getEpisodeDetails(b,function(b){a.episodedetails=b.result.episodedetails,a.getStreamInfo(a.episodedetails.file)})},a.getStreamInfo=function(b){var c=encodeURIComponent(b),d=window.base_url+"/vfs/"+c;return a.config={sources:[{src:f.trustAsResourceUrl(d),type:"video/mp4"}],theme:"lib/videogular-themes-default/videogular.min.css"},a.config},a.playEpisodeOnKodi=function(a){method="Player.Open",params='{"item":{"file":"'+a+'"}}',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,b,c,d){}).error(function(a,b,c,d){alert("Cannot play this episode")})},a.showSearch=!1,a.searchBox=function(){a.showSearch=!a.showSearch},a.Math=window.Math,a.toMinutes=function(a){var b=Math.floor(a/60),c=b+" minutes";return c},a.getThumbnailSeries=function(a){a=a.replace("image://","").replace("jpg/","jpg");var b=decodeURIComponent(a);return b},a.getThumbnailSeason=function(a){a=a.replace("image://","").replace("jpg/","jpg");var b=decodeURIComponent(a);return b}}]),app.factory("Loader",["$http","$ionicLoading",function(a,b){var c={};return c.getMovies=function(c){method="VideoLibrary.GetMovies",params='{"limits":{"start":0,"end":9999},"properties":["art","rating","thumbnail","playcount","file","year","genre","plot","runtime"],"sort": {"order":"ascending","method":"label","ignorearticle":true}},"id":"libMovies"',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+', "id" : 1}',complete_url=window.base_url+param_url,b.show(),a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,d,e,f){b.hide(),c(a)}).error(function(a,c,d,e){b.hide(),alert("Error fetching movies")})},c.getSeries=function(c){method="VideoLibrary.GetTVShows",params='{"limits": { "start" : 0, "end": 100}, "properties": ["art", "genre", "plot", "title", "originaltitle", "year", "rating", "thumbnail", "playcount", "file","season"], "sort": { "order": "ascending", "method": "label" }}, "id": "libTvShows"',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.show(),a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,d,e,f){b.hide(),c(a)}).error(function(a,c,d,e){b.hide(),alert("Error fetching TV shows")})},c.getSeasons=function(c,d){method="VideoLibrary.GetSeasons",void 0===c?params='{"limits": { "start" : 0, "end": 100}, "properties": ["season","showtitle","thumbnail","episode","tvshowid"], "sort": { "order": "ascending", "method": "label" }}, "id": "libTvShows"':params='{"tvshowid":'+c+',"limits": { "start" : 0, "end": 100}, "properties": ["season","showtitle","thumbnail","episode","tvshowid"], "sort": { "order": "ascending", "method": "label" }}, "id": "libTvShows"',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.show(),a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,c,e,f){b.hide(),d(a)}).error(function(a,c,d,e){b.hide(),alert("Error fetching seasons")})},c.getEpisodes=function(c,d,e){method="VideoLibrary.GetEpisodes",void 0===c||void 0===d?params='{"limits": { "start" : 0, "end": 100}, "properties": ["title","runtime","season","episode","tvshowid","file"], "sort": { "order": "ascending", "method": "label" } }, "id": "libTvShows"':params='{"tvshowid":'+c+',"season":'+d+',"limits": { "start" : 0, "end": 100}, "properties": ["title","runtime","season","episode","tvshowid","file"], "sort": { "order": "ascending", "method": "label" } }, "id": "libTvShows"',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.show(),a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,c,d,f){b.hide(),e(a)}).error(function(a,c,d,e){b.hide(),alert("Error fetching episodes")})},c.getEpisodeDetails=function(c,d){method="VideoLibrary.GetEpisodeDetails",params='{"episodeid":'+c+', "properties": ["title","runtime","rating","plot","season","episode","tvshowid","file","showtitle","thumbnail","fanart"]}, "id": "libTvShows"',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.show(),a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,c,e,f){b.hide(),d(a)}).error(function(a,c,d,e){b.hide(),alert("Error fetching this episode")})},c.getArtists=function(c){method="AudioLibrary.GetArtists",params='{"properties":["style","description","born","yearsactive","died","thumbnail","genre","fanart"],"limits":{"start":1,"end":2000}},"id":"libMusic"',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.show(),a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,d,e,f){b.hide(),c(a)}).error(function(a,c,d,e){b.hide(),alert("Error fetching artists")})},c.getAlbums=function(c,d){method="AudioLibrary.GetAlbums",void 0===c?params='{"limits":{"start":0,"end":9999},"properties":["playcount","artist","genre","rating","thumbnail","year","mood","style"],"sort":{"order":"ascending","method":"album","ignorearticle":true}},"id":"libAlbums"}':params='{"limits":{"start":0,"end":9999},"properties":["playcount","artist","genre","rating","thumbnail","year","mood","style"],"sort":{"order":"ascending","method":"album","ignorearticle":true},"filter":{"artistid":'+c+'}},"id":"libAlbums"}',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.show(),a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,c,e,f){b.hide(),d(a)}).error(function(a,c,d,e){b.hide(),alert("Error fetching albums")})},c.getSongs=function(c,d){method="AudioLibrary.GetSongs",0===c?params='{"limits":{"start":0,"end":9999},"properties":["file","artist","duration","album","albumid","track","playcount"],"sort":{"order":"ascending","method":"track","ignorearticle":true},"filter":{"albumid":"0"}},"id":"libSongs"}':params='{"limits":{"start":0,"end":9999},"properties":["file","artist","duration","album","albumid","track","playcount"],"sort":{"order":"ascending","method":"track","ignorearticle":true},"filter":{"albumid":'+c+'}},"id":"libSongs"}',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.show(),a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,c,e,f){b.hide(),d(a)}).error(function(a,c,d,e){b.hide(),alert("Error fetching songs")})},c.getSongDetails=function(c,d){method="AudioLibrary.GetSongDetails",params='{"songid":'+c+', "properties": ["title","artist","genre","duration","album","thumbnail","file"]}, "id": "libSongs"',param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+method+'", "params":'+params+"}",complete_url=window.base_url+param_url,b.show(),a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).success(function(a,c,e,f){b.hide(),d(a)}).error(function(a,c,d,e){b.hide(),alert("Error fetching this song")})},c}]),app.factory("Logger",["$http",function(a){var b={},c=!1,d=!1,e="Connect";return b.logout=function(){window.base_url="",c=!1,d=!1,e="Connect",alert("Disconnected")},b.login=function(b,f,g,h){window.base_url="http://"+b+":"+f+"@"+g+":"+h,ping_url='/jsonrpc?request={"jsonrpc":"2.0","method":"JSONRPC.Ping"}&callback=JSON_CALLBACK',a.jsonp(window.base_url+ping_url).success(function(a,b){c=!0,d=!1,e="Disconnect",window.location="#/remote"}).error(function(a,b){c=!1,d=!0,e="Connect",alert("Error "+b),console.log(window.base_url)})},b.getConn=function(){return c},b.getErr=function(){return d},b.getBouton=function(){return e},b}]),app.factory("Manager",["$http",function(a){var b={},c=!1,d=!0,e=!1,f=!1;return b.SetPlay=function(b){ping_url='/jsonrpc?request={"jsonrpc":"2.0","method":"Input.ExecuteAction", "params":{"action":"play"}}&callback=JSON_CALLBACK',a.jsonp(window.base_url+ping_url).success(function(a,e){d=!1,c=!0,b||(window.location="#/settings",window.location="#/remote")}).error(function(a,b){e=!0})},b.SetPause=function(b){ping_url='/jsonrpc?request={"jsonrpc":"2.0","method":"Input.ExecuteAction", "params":{"action":"pause"}}&callback=JSON_CALLBACK',a.jsonp(window.base_url+ping_url).success(function(a,e){c=!1,d=!0,b||(window.location="#/settings",window.location="#/remote")}).error(function(a,b){f=!0})},b.getPaused=function(){return d},b.getPlayed=function(){return c},b}]),app.factory("Requester",["$http","Manager","Sounder",function(a,b,c){var d={};return d.requestInput=function(c){switch(method="Input.",params="{}",c){case"left":method+="Left";break;case"right":method+="Right";break;case"up":method+="Up";break;case"down":method+="Down";break;case"select":method+="Select";break;case"home":method+="Home";break;case"back":method+="Back";break;case"playPic":b.SetPlay(1);break;case"play":b.SetPlay(0);break;case"pausePic":b.SetPause(1);break;case"pause":b.SetPause(0);break;case"stop":method+="ExecuteAction",params='{"action":"stop"}';break;case"next":method+="ExecuteAction",params='{"action":"skipnext"}';break;case"previous":method+="ExecuteAction",params='{"action":"skipprevious"}';break;case"fastforward":method+="ExecuteAction",params='{"action":"fastforward"}';break;case"rewind":method+="ExecuteAction",params='{"action":"rewind"}';break;case"zoom+":method+="ExecuteAction",params='{"action":"zoomin"}';break;case"zoom-":method+="ExecuteAction",params='{"action":"zoomout"}'}d.sendRequest(a,method,params)},d.requestApplication=function(b,e){switch(method="Application.",params="{}",b){case"shutdown":method+="Quit";break;case"mute":c.SetMute();break;case"unmute":c.SetUnMute();break;case"volumeUp":c.VolUp(e);break;case"volumeDown":c.VolDown(e)}d.sendRequest(a,method,params)},d.GetApplicationProperties=function(b){param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"Application.GetProperties","params":{"properties":["muted","volume"]},"id":1}&callback=JSON_CALLBACK',complete_url=window.base_url+param_url,a.jsonp(complete_url).success(function(a,c){b(a)}).error(function(a,b){})},d.requestGUI=function(b){switch(method="GUI.",b){case"fullscreen":method+="SetFullscreen",params='{"fullscreen":true}';break;case"pictures":window.location="#/tab/pics",method+="ActivateWindow",params='{"window" : "pictures"}'}d.sendRequest(a,method,params)},d.requestPlayer=function(b){switch(method="Player.",b){case"zoom":method+="Zoom",params='{"playerid":0,"zoom":"in"}'}d.sendRequest(a,method,params)},d.sendRequest=function(a,b,c){param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+b+'","params": '+c+', "id": 1}',complete_url=window.base_url+param_url,a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).error(function(){alert("You are not connected")})},d.sendRequestWithParamsForPlayer=function(a,b,c){ping_url='/jsonrpc?request={ "jsonrpc": "2.0", "method": "Player.GetActivePlayers", "id": 1 }&callback=JSON_CALLBACK',a.jsonp(window.base_url+ping_url).success(function(d,e){param_url='/jsonrpc?request={"jsonrpc":"2.0","method":"'+b+'","params": {"playerid":'+d.result[0].playerid+", "+c+'}, "id": 1}',complete_url=window.base_url+param_url,a.jsonp(complete_url,{params:{callback:"JSON_CALLBACK",format:"json"}}).error(function(){alert("You are not connected")})})},d}]),app.factory("Runtime",["$http",function(a){var b={moment2:0,temps:0,totaltime:0,playeractive:"undefined",shuffled:!1},c={};return c.SetRuntime=function(b){ping_url='/jsonrpc?request={ "jsonrpc": "2.0", "method": "Player.GetActivePlayers", "id": 1 }&callback=JSON_CALLBACK';var c;a.jsonp(window.base_url+ping_url).success(function(d,e){c='/jsonrpc?request={"jsonrpc":"2.0","id":1,"method":"Player.Seek","params":{"playerid":'+d.result[0].playerid+',"value":'+b+"}}&callback=JSON_CALLBACK",a.jsonp(window.base_url+c).success(function(a,b){}).error(function(a,b){})}).error(function(a,b){})},c.getDetails=function(b,c){ping_url='/jsonrpc?request={"jsonrpc":"2.0","method":"Player.GetItem","params":{"playerid":'+b+',"properties":["title","artist","thumbnail","album", "year"]},"id":4}&callback=JSON_CALLBACK',a.jsonp(window.base_url+ping_url).success(function(a,b){c(a)}).error(function(a,b){})},c.GetRuntime=function(){ping_url='/jsonrpc?request={"jsonrpc":"2.0","method": "Player.GetActivePlayers","id":1}&callback=JSON_CALLBACK';var d;return a.jsonp(window.base_url+ping_url).success(function(e,f){0!==e.result.length?(b.playeractive=e.result[0].playerid,d='/jsonrpc?request={"jsonrpc":"2.0","id":1,"method":"Player.GetProperties","params":{"playerid":'+e.result[0].playerid+',"properties":["percentage","time","totaltime", "repeat","shuffled","speed","subtitleenabled"] }}&callback=JSON_CALLBACK',a.jsonp(window.base_url+d).success(function(a,d){b.moment2=a.result.percentage,b.temps=a.result.time,b.totaltime=a.result.totaltime,b.shuffled=a.result.shuffled,b.repeat=a.result.repeat,b.speed=a.result.speed,b.subtitles=a.result.subtitleenabled,c.getDetails(b.playeractive,function(a){var c={};0===b.playeractive?(c.album=a.result.item.album,c.title=a.result.item.title,c.artist=a.result.item.artist,c.thumbnail=a.result.item.thumbnail,c.year=""):1===b.playeractive&&(c.title=a.result.item.title,c.thumbnail=a.result.item.thumbnail,c.year=a.result.item.year,c.album="",c.artist=""),b.getDetails=c})}).error(function(a,b){})):b.playeractive="undefined"}).error(function(a,b){}),b},c}]),app.factory("Sounder",["$http",function(a){var b={},c=!0,d=50;return b.VolUp=function(b){100>b&&(b+=1),ping_url='/jsonrpc?request={"jsonrpc":"2.0","method":"Application.SetVolume", "params":{"volume":'+b+"}}&callback=JSON_CALLBACK",a.jsonp(window.base_url+ping_url).success(function(a,c){d=b,window.location="#/settings",window.location="#/remote"}).error(function(a,b){})},b.VolDown=function(b){100>b&&(b-=1),ping_url='/jsonrpc?request={"jsonrpc":"2.0","method":"Application.SetVolume", "params":{"volume":'+b+"}}&callback=JSON_CALLBACK",a.jsonp(window.base_url+ping_url).success(function(a,c){d=b,window.location="#/settings",window.location="#/remote"}).error(function(a,b){})},b.SetVol=function(b){ping_url='/jsonrpc?request={"jsonrpc":"2.0","method":"Application.SetVolume", "params":{"volume":'+b+"}}&callback=JSON_CALLBACK",a.jsonp(window.base_url+ping_url).success(function(a,c){d=b,window.location="#/settings",window.location="#/remote"}).error(function(a,b){})},b.getMuted=function(){return c},b.getVolume=function(){return d},b}]);